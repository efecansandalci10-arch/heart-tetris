<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>ðŸ’– AÅŸkÄ±m Tetris ðŸ’–</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            height:100vh;
            display:flex;
            flex-direction:column;
            justify-content:center;
            align-items:center;
            font-family:'Arial', sans-serif;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            overflow:hidden;
            position:relative;
            touch-action: none; /* zoom engelle */
        }
        h1 {
            position:absolute;
            top:5%;
            font-size:2.5rem;
            color:white;
            text-shadow:0 0 10px #ff4e8a,0 0 20px #ff2e88;
        }
        #startBtn {
            position:absolute;
            padding:20px 30px;
            font-size:1.5rem;
            border:none;
            border-radius:50px;
            background:linear-gradient(45deg, #ff2e88, #ff4e8a);
            color:white;
            cursor:pointer;
            transition: all 0.3s ease;
            z-index:5;
        }
        canvas {
            display:none;
            background:#111;
            box-shadow:0 0 25px #ff2e88;
        }
        .heart {
            position:absolute;
            font-size:20px;
            color:rgba(255,46,136,0.7);
            animation: float linear infinite;
        }
        @keyframes float {
            0% {transform: translateY(100vh) rotate(0deg); opacity:0;}
            50% {opacity:1;}
            100% {transform: translateY(-10vh) rotate(360deg); opacity:0;}
        }
        @media (max-width:768px){
            canvas{ width:200px; height:400px; }
        }
    </style>
</head>

<body>
<h1>ðŸ’– AÅŸkÄ±m Tetris ðŸ’–</h1>
<button id="startBtn">BaÅŸlat</button>
<canvas id="game" width="300" height="600"></canvas>

<script>
    // -----------------------------
    // BaÅŸlangÄ±Ã§ kalpleri ekran sÄ±nÄ±rlarÄ±na yay
    // -----------------------------
    for(let i=0;i<30;i++){
        const heart=document.createElement('div');
        heart.classList.add('heart');
        heart.textContent='ðŸ’–';
        heart.style.left=Math.random()*100+'vw';  // ekran boyunca
        heart.style.top=Math.random()*90+'vh';    // Ã¼st sÄ±nÄ±rdan biraz boÅŸluk bÄ±rak
        heart.style.fontSize=15+Math.random()*25+'px';
        heart.style.animationDuration=5+Math.random()*10+'s';
        heart.style.animationDelay=Math.random()*5+'s';
        document.body.appendChild(heart);
    }

    // -----------------------------
    // BaÅŸlat butonu kovala
    // -----------------------------
    const startBtn=document.getElementById('startBtn');
    let clicks=0;
    startBtn.addEventListener('click',()=>{
        clicks++;
        if(clicks<4){
            startBtn.style.top=Math.random()*70+'vh';
            startBtn.style.left=Math.random()*70+'vw';
        } else{
            startBtn.textContent='ðŸ˜„';
            startBtn.style.top='50%';
            startBtn.style.left='50%';
            startBtn.style.transform='translate(-50%,-50%) scale(1.2)';
            startBtn.onclick=()=>{
                startBtn.style.display='none';
                document.getElementById('game').style.display='block';
                startTetris(true); // mobil true
            }
        }
    });

    // -----------------------------
    // Tetris kodu
    // -----------------------------
    const canvas=document.getElementById("game");
    const ctx=canvas.getContext("2d");

    let ROWS=20, COLS=10, SIZE=30;

    function updateSize(){
        if(window.innerWidth<=768){ 
            SIZE=30; ROWS=20; COLS=10; // mantÄ±ÄŸÄ± sabit bÄ±rak
        } else{ SIZE=30; ROWS=20; COLS=10; }
    }
    updateSize();
    window.addEventListener('resize',updateSize);

    let board=Array.from({length:ROWS},()=>Array(COLS).fill(0));

    const pieces=[
        [[1,1,0],[1,1,1]],
        [[1,1],[1,1]],
        [[1,1,1],[0,1,0]]
    ];

    let piece=null;

    function drawCell(x,y,color="#ff4e8a"){
        ctx.fillStyle=color;
        ctx.fillRect(x*SIZE,y*SIZE,SIZE,SIZE);
        ctx.strokeStyle="#111";
        ctx.strokeRect(x*SIZE,y*SIZE,SIZE,SIZE);
    }

    function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(let r=0;r<ROWS;r++)
            for(let c=0;c<COLS;c++)
                if(board[r][c]) drawCell(c,r);
        if(piece)
            piece.shape.forEach((row,r)=>{
                row.forEach((val,c)=>{
                    if(val) drawCell(piece.x+c,piece.y+r);
                });
            });
    }

    function collide(){
        for(let r=0;r<piece.shape.length;r++)
            for(let c=0;c<piece.shape[r].length;c++)
                if(piece.shape[r][c]){
                    let newX=piece.x+c;
                    let newY=piece.y+r;
                    if(newX<0||newX>=COLS||newY>=ROWS||board[newY]?.[newX]) return true;
                }
        return false;
    }

    function merge(){
        piece.shape.forEach((row,r)=>{
            row.forEach((val,c)=>{
                if(val) board[piece.y+r][piece.x+c]=1;
            });
        });
    }

    function clearLines(){
        board=board.filter(row=>row.some(cell=>!cell));
        while(board.length<ROWS) board.unshift(Array(COLS).fill(0));
    }

    function newPiece(){
        const shape=pieces[Math.floor(Math.random()*pieces.length)];
        piece={shape,x:4,y:0}; // baÅŸlangÄ±Ã§ y=0, canvas kÃ¼Ã§Ã¼ltÃ¼lse de mantÄ±k doÄŸru
        if(collide()){
            alert("Oyun Bitti ðŸ’”");
            board=Array.from({length:ROWS},()=>Array(COLS).fill(0));
        }
    }

    function move(dir){
        piece.x+=dir;
        if(collide()) piece.x-=dir;
        draw();
    }

    function rotate(){
        const old=piece.shape;
        const rotated=piece.shape[0].map((_,i)=>piece.shape.map(row=>row[i]).reverse());
        piece.shape=rotated;
        if(collide()) piece.shape=old;
        draw();
    }

    function drop(){
        piece.y++;
        if(collide()){
            piece.y--;
            merge();
            clearLines();
            newPiece();
        }
        draw();
    }

    function startTetris(isMobile=false){
        newPiece();
        draw();
        setInterval(drop,700);

        if(!isMobile){
            document.addEventListener("keydown",e=>{
                if(e.key==="ArrowLeft") move(-1);
                if(e.key==="ArrowRight") move(1);
                if(e.key==="ArrowDown") drop();
                if(e.key==="ArrowUp") rotate();
            });
        } else {
            // Mobil dokunmatik
            let touchStartX=0, touchStartY=0;
            canvas.addEventListener("touchstart", e=>{
                const touch=e.touches[0];
                touchStartX=touch.clientX;
                touchStartY=touch.clientY;
            });
            canvas.addEventListener("touchend", e=>{
                const touch=e.changedTouches[0];
                const dx=touch.clientX - touchStartX;
                const dy=touch.clientY - touchStartY;

                if(Math.abs(dx) > Math.abs(dy)){
                    if(dx>20) move(1);
                    else if(dx<-20) move(-1);
                } else {
                    if(dy<-20) rotate();
                    else if(dy>20) {
                        // AÅŸaÄŸÄ± kaydÄ±rÄ±nca normal Tetris gibi blok anÄ±nda dÃ¼ÅŸer
                        while(!collide()){ piece.y++; }
                        piece.y--;
                        merge();
                        clearLines();
                        newPiece();
                        draw();
                    }
                }
            });
        }
    }
</script>
</body>
</html>
